<script>
    const grid = document.getElementById('grid');
    let saved = JSON.parse(localStorage.getItem('lulu_savings')) || [];
    const TOTAL_GOAL = 66795;
    
    function updateDisplay() {
        const sum = saved.reduce((a, b) => a + b, 0);
        const count = saved.length;
        const percentage = ((count / 365) * 100).toFixed(1);
        
        document.getElementById('total').innerText = '$' + sum.toLocaleString();
        document.getElementById('remaining').innerText = '$' + (TOTAL_GOAL - sum).toLocaleString();
        document.getElementById('percent').innerText = percentage + '%';
        document.getElementById('pb').style.width = percentage + '%';
    }

    for (let i = 1; i <= 365; i++) {
        const box = document.createElement('div');
        // æª¢æŸ¥æ˜¯å¦å·²å­˜ï¼Œæ±ºå®šåˆå§‹ç‹€æ…‹
        box.className = 'box' + (saved.includes(i) ? ' done' : '');
        box.id = 'lulu-' + i;
        
        // é€™ä¸€è¡Œæœ€é‡è¦ï¼šç¢ºä¿æ•¸å­—è¢«å¯«å…¥ HTML
        box.innerText = i; 
        
        box.onclick = () => {
            if (saved.includes(i)) {
                if(confirm("è¦æŠŠé€™éš»è±¬è±¬æ”¾å›å»å—ï¼Ÿ")) {
                    saved = saved.filter(n => n !== i);
                    box.classList.remove('done');
                }
            } else {
                saved.push(i);
                box.classList.add('done');
                box.classList.remove('highlight');
            }
            localStorage.setItem('lulu_savings', JSON.stringify(saved));
            updateDisplay();
        };
        grid.appendChild(box);
    }

    // æŠ½çé‚è¼¯
    function drawLulu() {
        const pool = [];
        for(let i=1; i<=365; i++) if(!saved.includes(i)) pool.push(i);
        if(pool.length === 0) return alert("å…¨éƒ¨è±¬è±¬éƒ½è§£é–å•¦ï¼ğŸ·âœ¨");
        const activeHighlight = document.querySelector('.highlight');
        if(activeHighlight) activeHighlight.classList.remove('highlight');
        const pick = pool[Math.floor(Math.random() * pool.length)];
        const target = document.getElementById('lulu-' + pick);
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => {
            alert(`ğŸŠ æŠ½å‡ºï¼ä»Šå¤©çš„ LuLu ç›²ç›’é‡‘é¡ï¼š$${pick} å…ƒ`);
        }, 600);
    }
    updateDisplay();
</script>
